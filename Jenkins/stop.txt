#!/usr/bin/env bash
set -euo pipefail

# --- se positionner dans le répertoire bin ---
BIN_DIR="$(cd "$(dirname "$0")" && pwd)"
cd "$BIN_DIR"
echo "[stop.sh] CWD=$(pwd)"

# --- chemins calculés à partir de bin ---
APP_HOME="$(cd "$BIN_DIR/.." && pwd)"
COMMON="/serveur_apps/eai-camel-ops/bin/appctl.sh"

JAR="$APP_HOME/lib/app.jar"
RUN_DIR="$APP_HOME/run"

APP_INSTANCE="${1:-}"   # stop.sh [app-instance]

if [[ -z "$APP_INSTANCE" ]]; then
  echo "ERROR: missing app-instance (ex: eai-camel-rgv-mono / eai-camel-rgv-blue)"
  exit 2
fi

# --- debug : commande réelle ---
echo "[stop.sh] exec: $COMMON stop \
  --name '$APP_INSTANCE' \
  --run '$RUN_DIR' \
  --jar '$JAR'"

exec "$COMMON" stop \
  --name "$APP_INSTANCE" \
  --run "$RUN_DIR" \
  --jar "$JAR"
