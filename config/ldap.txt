export CATALINA_OPTS="$CATALINA_OPTS \
  -Dhawtio.role=GGS_EAI_HAWTIO_ADMIN \
  -Dhawtio.readonly.roles=GGS_EAI_HAWTIO_READ"

Base DN : OU=Utilisateurs,DC=f1nom0a,DC=local
User Search Filter : objectclass=user
Group Search Filter : (vide)


Base DN : OU=Groupes de Ressources,OU=Groupes,DC=f1nom0a,DC=local
User Search Filter : (vide)
Group Search Filter : (&(objectclass=Group)(cn=*))

Voici exactement ce qu‚Äôil te faut pour Tomcat 9 + Hawtio 3.0.2 : un Realm LDAP/AD au niveau de l‚Äôapplication via hawtio.xml, et o√π le mettre.


---

O√π cr√©er hawtio.xml sur Tomcat 9

Sur Tomcat 9, le fichier de contexte par application se met ici :

$CATALINA_BASE/conf/Catalina/localhost/hawtio.xml


Dans ton installation, c‚Äôest tr√®s souvent :

/opt/tomcat/conf/Catalina/localhost/hawtio.xml


üìå Le nom du fichier (hawtio.xml) correspond au context path /hawtio.

> Si ton WAR s‚Äôappelle hawtio.war, le context path sera /hawtio.




---

hawtio.xml (AD/LDAP) avec tes 2 groupes

Ce fichier configure le Realm JNDI qui :

cherche l‚Äôutilisateur dans : OU=Utilisateurs,DC=f1nom0a,DC=local

cherche les groupes dans : OU=Groupes de Ressources,OU=Groupes,DC=f1nom0a,DC=local

remonte les r√¥les depuis les groupes

et fait correspondre les r√¥les au CN du groupe (donc tes r√¥les = noms de groupes)


Cr√©e le fichier :

üìÑ /opt/tomcat/conf/Catalina/localhost/hawtio.xml

<Context>

  <Realm className="org.apache.catalina.realm.JNDIRealm"

         <!-- URL de ton LDAP/AD -->
         connectionURL="ldap://AD_HOSTNAME_OU_IP:389"

         <!-- Compte de bind (recommand√©) -->
         connectionName="CN=svc_hawtio,OU=Comptes de Service,DC=f1nom0a,DC=local"
         connectionPassword="CHANGE_ME"

         <!-- ===== USERS ===== -->
         userBase="OU=Utilisateurs,DC=f1nom0a,DC=local"
         userSearch="(sAMAccountName={0})"
         userSubtree="true"

         <!-- ===== GROUPS / ROLES ===== -->
         roleBase="OU=Groupes de Ressources,OU=Groupes,DC=f1nom0a,DC=local"
         roleSearch="(&(objectClass=group)(member={0}))"
         roleSubtree="true"
         roleName="cn"

         <!-- Qualit√© de vie AD -->
         referrals="follow"
         />

</Context>

Pourquoi je n‚Äôai pas repris ‚Äúobjectclass=user‚Äù en filtre userSearch ?

Parce que Tomcat a besoin d‚Äôun filtre qui retrouve l‚Äôutilisateur √† partir du login.
Ton ‚ÄúUser Search Filter : objectclass=user‚Äù seul ne suffit pas (il match tous les users).

Le standard AD est :

userSearch="(sAMAccountName={0})"


Tu peux ajouter objectClass=user si tu veux √™tre strict :

userSearch="(&(objectClass=user)(sAMAccountName={0}))"

Ton ‚ÄúGroup Search Filter‚Äù (&(objectclass=Group)(cn=*))

Ce filtre liste les groupes, mais ne dit pas quels groupes appartiennent √† l‚Äôutilisateur.
Pour Hawtio, on veut les groupes o√π l‚Äôutilisateur est membre, donc :

roleSearch="(&(objectClass=group)(member={0}))"


C‚Äôest le bon pattern pour AD (groupes non imbriqu√©s).


---

Important : tes 2 groupes (r√¥les)

Assure-toi que dans AD, le CN des groupes est exactement :

GGS_EAI_HAWTIO_ADMIN

GGS_EAI_HAWTIO_READ


Comme on a roleName="cn", Tomcat exposera ces CN comme r√¥les, utilisables dans le web.xml Hawtio.


---

√Ä ne pas oublier c√¥t√© Hawtio : web.xml

Ton hawtio.xml g√®re LDAP, mais il faut toujours que Hawtio soit prot√©g√© par r√¥les dans web.xml (tu l‚Äôas d√©j√† demand√© plus haut). Il doit contenir les 2 r√¥les.


---

Cas AD avec groupes imbriqu√©s (nested groups)

Si tes groupes peuvent √™tre imbriqu√©s, le member={0} ne remonte pas toujours tout.
On peut alors passer par une requ√™te sur memberOf / matching rule AD, mais c‚Äôest un r√©glage diff√©rent. Si tu es dans ce cas, dis-le et je te donne la version ‚Äúnested‚Äù.


---

Mini checklist de validation

1. Le WAR s‚Äôappelle bien hawtio.war ‚Üí URL /hawtio


2. Le fichier existe : /opt/tomcat/conf/Catalina/localhost/hawtio.xml


3. Red√©marrage Tomcat


4. Dans les logs, tu dois voir l‚Äôauth LDAP passer (et des r√¥les r√©cup√©r√©s)




---

Si tu me dis :

l‚Äôattribut de login utilis√© (souhaites-tu sAMAccountName ou userPrincipalName ?),

et si tes groupes sont imbriqu√©s ou non,


je te fournis la variante parfaite (et la version LDAPS avec truststore si tu veux passer en 636).
