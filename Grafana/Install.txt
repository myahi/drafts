Yes ğŸ‘
Voici la checklist complÃ¨te Prometheus + HTTPS natif + Grafana, de A Ã  Z sur RHEL 9, sans Nginx, avec auth uniquement dans Grafana.

Je te la donne dans lâ€™ordre logique, prÃªte Ã  dÃ©rouler.


---

âœ… Checklist complÃ¨te â€” Prometheus + HTTPS natif + Grafana (RHEL 9)


---

ğŸ”µ PARTIE 1 â€” PROMETHEUS (HTTPS NATIF)

(Identique Ã  ce quâ€™on a validÃ©, je la remets pour continuitÃ©)

1ï¸âƒ£ PrÃ©-requis

sudo dnf update -y


---

2ï¸âƒ£ Utilisateur Prometheus

sudo useradd --no-create-home --shell /sbin/nologin prometheus


---

3ï¸âƒ£ RÃ©pertoires

sudo mkdir -p /etc/prometheus /var/lib/prometheus /etc/prometheus/tls
sudo chown -R prometheus:prometheus /etc/prometheus /var/lib/prometheus


---

4ï¸âƒ£ TÃ©lÃ©charger Prometheus

cd /tmp
curl -LO https://github.com/prometheus/prometheus/releases/latest/download/prometheus-linux-amd64.tar.gz
tar xvf prometheus-linux-amd64.tar.gz
cd prometheus-linux-amd64


---

5ï¸âƒ£ Installer binaires

sudo cp prometheus promtool /usr/local/bin/
sudo chown prometheus:prometheus /usr/local/bin/prometheus /usr/local/bin/promtool


---

6ï¸âƒ£ Config Prometheus

sudo cp prometheus.yml /etc/prometheus/
sudo cp -r consoles console_libraries /etc/prometheus/
sudo chown -R prometheus:prometheus /etc/prometheus

/etc/prometheus/prometheus.yml

global:
  scrape_interval: 15s

scrape_configs:
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

promtool check config /etc/prometheus/prometheus.yml


---

7ï¸âƒ£ HTTPS natif Prometheus

sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /etc/prometheus/tls/prometheus.key \
  -out /etc/prometheus/tls/prometheus.crt

sudo chmod 600 /etc/prometheus/tls/prometheus.key
sudo chown -R prometheus:prometheus /etc/prometheus/tls


---

8ï¸âƒ£ web.yml

sudo vi /etc/prometheus/web.yml

tls_server_config:
  cert_file: /etc/prometheus/tls/prometheus.crt
  key_file: /etc/prometheus/tls/prometheus.key

sudo chown prometheus:prometheus /etc/prometheus/web.yml
sudo chmod 600 /etc/prometheus/web.yml


---

9ï¸âƒ£ Service systemd Prometheus

sudo vi /etc/systemd/system/prometheus.service

[Service]
User=prometheus
ExecStart=/usr/local/bin/prometheus \
  --config.file=/etc/prometheus/prometheus.yml \
  --storage.tsdb.path=/var/lib/prometheus \
  --web.config.file=/etc/prometheus/web.yml

sudo systemctl daemon-reload
sudo systemctl enable prometheus
sudo systemctl restart prometheus


---

ğŸ”¥ 10ï¸âƒ£ Firewall Prometheus

ğŸ‘‰ Autoriser uniquement Grafana

sudo firewall-cmd --add-rich-rule='rule family="ipv4" source address="IP_GRAFANA" port port="9090" protocol="tcp" accept' --permanent
sudo firewall-cmd --reload


---

ğŸŸ¢ PARTIE 2 â€” GRAFANA


---

1ï¸âƒ£ Installer Grafana (repo officiel)

sudo tee /etc/yum.repos.d/grafana.repo <<'EOF'
[grafana]
name=Grafana
baseurl=https://rpm.grafana.com
repo_gpgcheck=1
enabled=1
gpgcheck=1
gpgkey=https://rpm.grafana.com/gpg.key
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
EOF

sudo dnf install -y grafana


---

2ï¸âƒ£ DÃ©marrer Grafana

sudo systemctl daemon-reload
sudo systemctl enable grafana-server
sudo systemctl start grafana-server
sudo systemctl status grafana-server


---

3ï¸âƒ£ Firewall Grafana

sudo firewall-cmd --add-port=3000/tcp --permanent
sudo firewall-cmd --reload


---

4ï¸âƒ£ AccÃ¨s initial Grafana

Navigateur :

http://<serveur-grafana>:3000

Login par dÃ©faut :

admin / admin

â¡ï¸ changement de mot de passe obligatoire


---

5ï¸âƒ£ Ajouter Prometheus comme datasource

Grafana â†’ Connections â†’ Data sources â†’ Add data source â†’ Prometheus

URL


https://<serveur-prometheus>:9090

TLS

â˜‘ Skip TLS verify (cert auto-signÃ©)

ou importer le CA interne



ğŸ‘‰ Save & Test â†’ OK


---

6ï¸âƒ£ Dashboard de test

Import rapide :

Dashboard ID : 1860 (Node Exporter Full)

Ou test simple :


up


---

ğŸ” Bonnes pratiques finales

âœ” Prometheus HTTPS natif
âœ” Prometheus non exposÃ© publiquement
âœ” Auth centralisÃ©e Grafana
âœ” Firewall restrictif
âœ” Architecture simple


---

â• Prochaines Ã©tapes possibles

Node Exporter

HTTPS Grafana

LDAP / OAuth / Keycloak

mTLS Grafana â†” Prometheus

DÃ©ploiement Ansible


Si tu veux, dis-moi : ğŸ‘‰ Grafana et Prometheus sur la mÃªme VM ou sÃ©parÃ©es ?
Je tâ€™adapte la conf rÃ©seau / sÃ©curitÃ© au poil ğŸ§ ğŸ’¡
