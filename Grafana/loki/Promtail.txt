# This minimal config scrape only single log file.
# Primarily used in rpm/deb packaging where promtail service can be started during system init process.
# And too much scraping during init process can overload the complete system.
# https://github.com/grafana/loki/issues/11398

server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /var/lib/promtail/positions.yaml

clients:
- url: http://sdv4ems01:3100/loki/api/v1/push

scrape_configs:
- job_name: spring-boot
  static_configs:
     - targets: [localhost]
       labels:
         app: eai-camel-report
         env: dev
         instance: mono
         module: base
         __path__: /serveur_apps/eai-camel-report/mono/eai-camel-report-base/run/logs/*.log

     - targets: [localhost]
       labels:
         app: eai-camel-report
         env: dev
         instance: mono
         module: cashflows
         __path__: /serveur_apps/eai-camel-report/mono/eai-camel-report-cashflows/run/logs/*.log

     - targets: [localhost]
       labels:
         app: eai-camel-report
         env: dev
         instance: rouge
         module: base
         __path__: /serveur_apps/eai-camel-report/rouge/eai-camel-report-base/run/logs/*.log

     - targets: [localhost]
       labels:
         app: eai-camel-report
         env: dev
         instance: rouge
         module: cashflows
         __path__: /serveur_apps/eai-camel-report/rouge/eai-camel-report-cashflows/run/logs/*.log
  pipeline_stages:
     - multiline:
       firstline: '^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3}'
       max_wait_time: 3s
