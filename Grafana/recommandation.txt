Excellente question â€” et tu touches exactement Ã  lâ€™articulation Prometheus â†” Spring Boot â†” Camel ğŸ‘
RÃ©ponse courte : app nâ€™est liÃ© Ã  aucune clÃ© Spring Boot par dÃ©faut.
ğŸ‘‰ Câ€™est toi qui dÃ©cides si (et comment) tu le fais correspondre cÃ´tÃ© application.

Je tâ€™explique les 3 faÃ§ons correctes, puis je te dis laquelle je recommande.


---

1ï¸âƒ£ Ce que fait rÃ©ellement le label app

Dans ton JSON Prometheus :

"labels": {
  "app": "pizza5-camel-B",
  "env": "prod"
}

ğŸ‘‰ Ce label est injectÃ© par Prometheus, au moment du scrape.
ğŸ‘‰ Il nâ€™existe pas dans lâ€™application elle-mÃªme.

Donc :

Spring Boot nâ€™en sait rien

Camel nâ€™en sait rien

Micrometer nâ€™en sait rien


Câ€™est juste un label externe, trÃ¨s courant.


---

2ï¸âƒ£ Option A â€” Label app uniquement cÃ´tÃ© Prometheus (simple et OK)

Tu ne mets rien dans application.properties.

Avantages :

zÃ©ro config cÃ´tÃ© appli

trÃ¨s clair pour Grafana

dÃ©couplÃ© du code


InconvÃ©nient :

les mÃ©triques Camel/Micrometer nâ€™ont pas ce tag â€œnatifâ€ (mais Grafana sâ€™en fiche)


ğŸ‘‰ Câ€™est parfaitement valide, surtout si Prometheus est la source de vÃ©ritÃ©.


---

3ï¸âƒ£ Option B â€” Synchroniser app avec Micrometer (recommandÃ©)

Tu fais correspondre le label Prometheus et un tag Micrometer.

application.properties

management.metrics.tags.app=pizza5-camel-B
management.metrics.tags.env=prod

RÃ©sultat :

Les mÃ©triques exposÃ©es par lâ€™appli ont dÃ©jÃ  app et env

Prometheus fusionne ces labels avec les siens

Grafana filtre partout de faÃ§on cohÃ©rente


ğŸ‘‰ Câ€™est la meilleure pratique en prod.


---

4ï¸âƒ£ Option C â€” Utiliser spring.application.name (souvent utilisÃ©, mais piÃ¨ge)

spring.application.name=pizza5-camel-B

âš ï¸ Attention :

Micrometer mappe souvent Ã§a vers le label application

Pas toujours vers app

Les dashboards Camel utilisent rarement application par dÃ©faut


Tu peux lâ€™utiliser en plus, mais pas comme seul repÃ¨re.


---

5ï¸âƒ£ Ce que je te recommande (clair et propre)

CÃ´tÃ© Spring Boot / Camel

spring.application.name=pizza5-camel
management.metrics.tags.app=pizza5-camel-B
management.metrics.tags.env=prod

CÃ´tÃ© Prometheus (camel-B.json)

"labels": {
  "app": "pizza5-camel-B",
  "env": "prod"
}

â¡ï¸ Les labels sont alignÃ©s partout
â¡ï¸ Un seul dashboard Grafana fonctionne pour toutes les JVM
â¡ï¸ Pas dâ€™ambiguÃ¯tÃ© dans 6 mois


---

6ï¸âƒ£ VÃ©rification rapide

Sur /actuator/prometheus, tu dois voir :

camel_exchange_total{app="pizza5-camel-B",env="prod",...}

Et dans Prometheus :

up{job="camel-jvm", app="pizza5-camel-B"}


---

TL;DR

app nâ€™existe pas par dÃ©faut dans Spring Boot

Soit tu le laisses 100% cÃ´tÃ© Prometheus

Soit (recommandÃ©) tu lâ€™ajoutes via

management.metrics.tags.app=...

Ã‰vite de dÃ©pendre uniquement de spring.application.name


Si tu veux, je peux te proposer :

un schÃ©ma de labels standard (app / service / instance / env / version),

ou un extrait de dashboard JSON Camel qui utilise exactement ces labels.
