import org.springframework.context.Lifecycle;
import org.springframework.context.Phased;
import org.springframework.stereotype.Service;

@Service
public class TranscoService implements Lifecycle, Phased {

    private final CriticalResourcesGuard guard;
    private volatile boolean running = false;

    public TranscoService(CriticalResourcesGuard guard) {
        this.guard = guard;
    }

    @Override
    public void start() {
        if (!guard.isRunning()) {
            throw new IllegalStateException("Guard not ready");
        }
        // init réelle
        running = true;
    }

    @Override
    public void stop() { running = false; }

    @Override
    public boolean isRunning() { return running; }

    @Override
    public int getPhase() {
        return 0; // démarre après le guard
    }
}
